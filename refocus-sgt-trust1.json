{
  "name": "refocus-sgt-trust1",
  "version": "1.0.0",
  "description": "A Refocus Sample Generator Template for generating samples based on Salesforce's Trust1 API.",
  "tags": [
    "refocus",
    "salesforce",
    "status",
    "trust",
    "trust1"
  ],
  "author": {
    "name": "Salesforce CX Tools",
    "email": "SiteReliabilityTools@salesforce.com"
  },
  "connection": {
    "method": "GET",
    "headers": {
      "Accept": "application/json"
    },
    "url": "{{baseTrustUrl}}/v1/instances/status/preview",
    "bulk": true
  },
  "contextDefinition": {
    "baseTrustUrl": {
      "required": true,
      "description": "The base url of your Trust1 API endpoint, e.g. 'https://api.status.salesforce.com'."
    },
    "errorValue": {
      "required": false,
      "default": "-1",
      "description": "An error sample's value, e.g. '-1'."
    },
    "statusLinkUrl": {
      "required": true,
      "description": "The base url of your Trust1 endpoint for a sample's related links, e.g. 'http://status.salesforce.com/status/'."
    },
    "statusMap": {
      "required": false,
      "default": {
        "OK": {
          "value": "0"
        },
        "INFORMATIONAL_NONCORE": {
          "value": "1"
        },
        "MAINTENANCE_NONCORE": {
          "value": "1"
        },
        "MINOR_INCIDENT_NONCORE": {
          "value": "2"
        },
        "MAJOR_INCIDENT_NONCORE": {
          "value": "3"
        },
        "INFORMATIONAL_CORE": {
          "value": "1",
          "messageCode": "CORE"
        },
        "MAINTENANCE_CORE": {
          "value": "1",
          "messageCode": "CORE"
        },
        "MINOR_INCIDENT_CORE": {
          "value": "2",
          "messageCode": "CORE"
        },
        "MAJOR_INCIDENT_CORE": {
          "value": "3",
          "messageCode": "CORE"
        }
      },
      "description": "An object which maps each Trust1 status enum value to a sample value, messageCode and messageBody."
    }
  },
  "transform": {
    "errorHandlers": {},
    "responseSchema": "{\"type\":\"object\",\"required\":[\"body\"],\"properties\":{\"body\":{\"type\":\"array\",\"minItems\":1,\"items\":{\"type\":\"object\",\"required\":[\"key\"],\"properties\":{\"key\":{\"type\":\"string\",\"maxLength\":255},\"location\":{\"type\":\"string\",\"maxLength\":255},\"environment\":{\"type\":\"string\",\"maxLength\":255},\"releaseVersion\":{\"type\":\"string\",\"maxLength\":255},\"releaseNumber\":{\"type\":\"string\",\"maxLength\":255},\"status\":{\"type\":\"string\",\"enum\":[\"OK\",\"MAJOR_INCIDENT_CORE\",\"MINOR_INCIDENT_CORE\",\"MAINTENANCE_CORE\",\"MAJOR_INCIDENT_NONCORE\",\"MINOR_INCIDENT_NONCORE\",\"MAINTENANCE_NONCORE\"],\"maxLength\":255},\"isActive\":{\"type\":\"boolean\"},\"Products\":{\"type\":\"array\"},\"Incidents\":{\"type\":\"array\"},\"Maintenances\":{\"type\":\"array\"},\"Tags\":{\"type\":\"array\"}}}}}}",
    "default": "const e=aspects[0].name,s=`${ctx.baseTrustUrl}/v1/instances/status/preview`,t=[],a={};var r,o;return subjects.forEach(e=>a[e.name.toLowerCase()]=e.absolutePath),res.body.filter(e=>e.hasOwnProperty('key')&&a[e.key.toLowerCase()]).forEach(s=>{const u=ctx.statusMap[s.status]||{messageBody:'',messageCode:''},l=a[s.key.toLowerCase()];t.push({messageBody:(r=u.messageBody||'',o=4096,'number'==typeof o&&o>=4&&'string'==typeof r&&r.length>o?r.substring(0,o-3)+'...':r),messageCode:u.messageCode||'',name:`${l}|${e}`,relatedLinks:[n(ctx.statusLinkUrl,s.key)],value:u.value||s.status}),delete a[s.key.toLowerCase()]}),Object.keys(a).forEach(r=>t.push({messageBody:`Status for ${r} not returned by ${s}.`,messageCode:'',name:`${a[r]}|${e}`,relatedLinks:[n(ctx.statusLinkUrl,r)],value:ctx.errorValue})),t;function n(e,s){return{name:'Trust',url:`${e}/${s}`}}"
  }
}
